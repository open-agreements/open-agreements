# OpenAgreements OpenSpec Traceability Matrix

> Auto-generated by `scripts/validate_openspec_coverage.mjs`.
> Do not hand-edit this file.

This matrix maps canonical OpenSpec `#### Scenario:` entries to test-local `.openspec(...)` bindings.

## Capability: `open-agreements`

| Scenario | Status | Mapped Tests | Notes |
|---|---|---|---|
| [OA-001] Sandbox enabled by default | covered | `integration-tests/security-behavior.test.ts:57 :: fillDocx uses sandboxed rendering by default` |  |
| [OA-002] Malicious template expression blocked | covered | `integration-tests/security-behavior.test.ts:86 :: fillDocx blocks malicious template expressions` |  |
| [OA-003] Required field missing from DOCX | covered | `integration-tests/template-validation.test.ts:192 :: reports error for missing required placeholder` |  |
| [OA-004] Optional field missing from DOCX | covered | `integration-tests/template-validation.test.ts:211 :: reports warning for missing optional placeholder` |  |
| [OA-005] Output heading validation | covered | `integration-tests/output-validation.test.ts:70 :: compares heading counts from extracted document XML` |  |
| [OA-006] Template placeholder extraction | covered | `integration-tests/scan-command.test.ts:58 :: discovers bracketed placeholders in DOCX` |  |
| [OA-007] Enum field without options | covered | `src/core/metadata.test.ts:52 :: rejects enum field without options` |  |
| [OA-008] Default value type mismatch | covered | `src/core/metadata.test.ts:93 :: rejects number field with non-numeric default` |  |
| [OA-009] Unknown key in fill values | covered | `integration-tests/security-behavior.test.ts:105 :: fillTemplate warns on unknown input keys` |  |
| [OA-010] Multi-commit PR license check | covered | `integration-tests/workflow-license-check.test.ts:16 :: uses PR base SHA for pull_request events` |  |
| [OA-011] Push to main license check | covered | `integration-tests/workflow-license-check.test.ts:26 :: uses HEAD~1 for push events` |  |
| [OA-012] Full pipeline with auto-download | covered | `integration-tests/recipe-command.test.ts:48 :: runRecipeCommand omits inputPath to allow auto-download`, `src/core/recipe/index.test.ts:211 :: uses downloader path when inputPath is omitted` |  |
| [OA-013] Full pipeline with user-supplied input | covered | `integration-tests/recipe-command.test.ts:72 :: runRecipeCommand forwards a user-supplied input path`, `src/core/recipe/index.test.ts:69 :: forwards requiredFieldNames when inputPath is supplied` |  |
| [OA-014] Keep intermediate files | covered | `integration-tests/recipe-command.test.ts:97 :: runRecipeCommand forwards keepIntermediate flag` |  |
| [OA-015] Run full pipeline | covered | `integration-tests/recipe-command.test.ts:48 :: runRecipeCommand omits inputPath to allow auto-download` |  |
| [OA-016] Run clean stage only | covered | `integration-tests/recipe-command.test.ts:146 :: runRecipeClean invokes cleanDocument with recipe config` |  |
| [OA-017] Run patch stage only | covered | `integration-tests/recipe-command.test.ts:166 :: runRecipePatch invokes patchDocument with recipe replacements` |  |
| [OA-018] Remove footnotes | covered | `src/core/recipe/patcher-extensions.test.ts:570 :: returns footnote text when extractGuidance is true` |  |
| [OA-019] Remove paragraph patterns | covered | `integration-tests/fill-pipeline.test.ts:408 :: strips drafting note paragraphs by default` |  |
| [OA-020] Single-run replacement | covered | `src/core/recipe/patcher.test.ts:65 :: replaces a placeholder within a single run` |  |
| [OA-021] Cross-run replacement | covered | `src/core/recipe/patcher.test.ts:86 :: replaces a placeholder split across multiple runs` |  |
| [OA-022] Smart quote handling | covered | `src/core/recipe/verifier.test.ts:123 :: matches with smart quotes normalized to straight` |  |
| [OA-023] Table cell processing | covered | `src/core/recipe/patcher-extensions.test.ts:73 :: replaces placeholder only in the matching table row` |  |
| [OA-024] All values present | covered | `src/core/recipe/verifier.test.ts:185 :: finds values present only in header text` |  |
| [OA-025] Unrendered tags detected | covered | `integration-tests/fill-pipeline.test.ts:209 :: catches unrendered template tags` |  |
| [OA-026] Leftover brackets detected | covered | `src/core/recipe/verifier.test.ts:213 :: detects leftover bracketed placeholders from replacement keys` |  |
| [OA-027] Placeholder discovery | covered | `integration-tests/scan-command.test.ts:58 :: discovers bracketed placeholders in DOCX` |  |
| [OA-028] Draft replacements output | covered | `integration-tests/scan-command.test.ts:69 :: writes draft replacements JSON` |  |
| [OA-029] Valid recipe metadata | covered | `src/core/metadata.test.ts:225 :: accepts valid recipe metadata` |  |
| [OA-030] Missing source_url | covered | `src/core/metadata.test.ts:239 :: rejects missing source_url` |  |
| [OA-031] DOCX file detected in recipe directory | covered | `integration-tests/recipe-validation-negative.test.ts:38 :: rejects committed DOCX files in recipe directories` |  |
| [OA-032] Scaffold recipe validation | covered | `integration-tests/recipe-validation.test.ts:29 :: validates nvca-certificate-of-incorporation (scaffold)` |  |
| [OA-033] Replacement target not covered by metadata | covered | `integration-tests/recipe-validation-negative.test.ts:50 :: warns when replacement targets are not in metadata fields` |  |
| [OA-034] Successful template fill | covered | `integration-tests/cli-interface.test.ts:113 :: fill command renders output DOCX from template values`, `integration-tests/fill-command.inprocess.test.ts:140 :: fills a template path and defaults output filename` |  |
| [OA-035] Missing required field | covered | `integration-tests/cli-interface.test.ts:291 :: fill command reports missing required fields`, `integration-tests/fill-command.inprocess.test.ts:202 :: reports missing required fields before template fill` |  |
| [OA-036] Fixed term selection removes non-selected options | covered | `integration-tests/mutual-nda-selections.allure.test.ts:60 :: fixed-term flow removes non-selected options` |  |
| [OA-037] Perpetual selection marks selected options | covered | `integration-tests/mutual-nda-selections.allure.test.ts:64 :: perpetual flow marks selected options` |  |
| [OA-038] Valid metadata passes validation | covered | `src/core/metadata.test.ts:137 :: accepts valid template metadata` |  |
| [OA-039] Missing metadata field fails validation | covered | `src/core/metadata.test.ts:154 :: rejects metadata missing required license field` |  |
| [OA-040] Invalid license enum fails validation | covered | `src/core/metadata.test.ts:170 :: rejects invalid license` |  |
| [OA-041] Derivative blocked for non-derivative license | covered | `integration-tests/cli-interface.test.ts:301 :: fill command blocks templates marked allow_derivatives=false`, `integration-tests/fill-command.inprocess.test.ts:170 :: blocks template fill when allow_derivatives is false` |  |
| [OA-042] CI blocks modification of CC BY-ND template | covered | `integration-tests/workflow-license-check.test.ts:34 :: checks modified allow_derivatives=false templates and exits non-zero` |  |
| [OA-043] External template fill | covered | `integration-tests/external.test.ts:129 :: fills yc-safe-valuation-cap with sample values`, `integration-tests/fill-command.inprocess.test.ts:235 :: routes external IDs to external fill pipeline`, `src/core/external/index.test.ts:64 :: passes requiredFieldNames through to unified fill pipeline` |  |
| [OA-044] External metadata requires source_sha256 | covered | `integration-tests/external.test.ts:46 :: rejects missing source_sha256` |  |
| [OA-045] External template appears in list output | covered | `integration-tests/external.test.ts:187 :: list --json includes yc-safe templates` |  |
| [OA-046] Fill command renders output | covered | `integration-tests/cli-interface.test.ts:113 :: fill command renders output DOCX from template values`, `integration-tests/cli-program.test.ts:49 :: parses fill command data and set flags into runFill payload`, `integration-tests/fill-command.inprocess.test.ts:140 :: fills a template path and defaults output filename` |  |
| [OA-047] List command shows templates | covered | `integration-tests/cli-interface.test.ts:339 :: list command shows templates in human-readable output`, `integration-tests/cli-program.test.ts:176 :: forwards list flags to runList`, `integration-tests/list-command.inprocess.test.ts:310 :: renders human-readable table rows with error placeholders when metadata fails` |  |
| [OA-048] Skill interviews user for field values | covered | `integration-tests/agent-skill-behavior.test.ts:70 :: generated Claude skill interviews user in AskUserQuestion rounds` |  |
| [OA-049] Skill renders DOCX after interview | covered | `integration-tests/agent-skill-behavior.test.ts:76 :: generated Claude skill renders DOCX via fill command after interview` |  |
| [OA-050] Output structure matches source | covered | `integration-tests/output-validation.test.ts:70 :: compares heading counts from extracted document XML` |  |
| [OA-051] Structural drift detected | covered | `integration-tests/output-validation.test.ts:89 :: detects structural drift when heading counts differ` |  |
| [OA-052] Claude Code adapter implements interface | covered | `integration-tests/agent-skill-behavior.test.ts:46 :: ClaudeCodeAdapter implements ToolCommandAdapter interface` |  |
| [OA-053] New adapter can be added without modifying core | covered | `integration-tests/agent-skill-behavior.test.ts:55 :: new adapter can be added without modifying core` |  |
| [OA-054] Skill renders DOCX via npx (zero pre-install) | covered | `integration-tests/agent-skill-behavior.test.ts:82 :: documents npx zero-preinstall DOCX rendering path` |  |
| [OA-055] Skill renders DOCX via installed CLI | covered | `integration-tests/agent-skill-behavior.test.ts:86 :: documents installed CLI DOCX rendering path` |  |
| [OA-056] Preview-only fallback without Node.js | covered | `integration-tests/agent-skill-behavior.test.ts:90 :: documents preview-only fallback when Node.js is unavailable` |  |
| [OA-057] JSON output includes full metadata sorted by name | covered | `integration-tests/list-command.inprocess.test.ts:147 :: emits sorted JSON envelope with normalized sources and mapped fields`, `integration-tests/list.test.ts:54 :: items are sorted by name`, `integration-tests/list.test.ts:61 :: items include full template metadata in json output` |  |
| [OA-058] --json-strict exits non-zero on metadata errors | covered | `integration-tests/list-command.inprocess.test.ts:216 :: exits non-zero in --json-strict mode when metadata loading fails`, `integration-tests/list.test.ts:102 :: --json-strict exits non-zero on metadata errors` |  |
| [OA-059] --templates-only filters to templates | covered | `integration-tests/list-command.inprocess.test.ts:245 :: honors templates-only by skipping external and recipe metadata`, `integration-tests/list.test.ts:81 :: --templates-only filters to templates` |  |
| [OA-060] Clean install from registry works | covered | `integration-tests/packaging.test.ts:72 :: installs from packed tarball and runs list --json` |  |
| [OA-061] Computed profile is optional and non-breaking | covered | `src/core/recipe/index.test.ts:69 :: forwards requiredFieldNames when inputPath is supplied` |  |
| [OA-062] Rule-driven derived values are computed deterministically | covered | `integration-tests/nvca-computed-combinatorial.test.ts:265 :: uses pairwise reduction to cover interaction space without full Cartesian explosion`, `src/core/recipe/computed.test.ts:16 :: evaluates dispute-resolution interaction rules deterministically across bounded passes`, `src/core/recipe/index.test.ts:114 :: applies computed rules and captures pass-level trace` |  |
| [OA-063] Computed artifact file is written on request | covered | `integration-tests/recipe-command.test.ts:120 :: runRecipeCommand forwards computed artifact output path` |  |
| [OA-064] Artifact trace includes rule match outcomes and assignments | covered | `src/core/recipe/index.test.ts:114 :: applies computed rules and captures pass-level trace` |  |
| [OA-065] Invalid computed profile fails recipe validation | covered | `integration-tests/recipe-validation-negative.test.ts:82 :: rejects computed profiles with unsupported predicate operators` |  |
| [OA-066] Dispute resolution interaction produces required computed outputs | covered | `integration-tests/nvca-computed-combinatorial.test.ts:222 :: achieves MC/DC-style coverage for dispute-resolution forum and governing-law alignment chain`, `integration-tests/nvca-computed-combinatorial.test.ts:286 :: enforces dispute-resolution invariants across deterministic pseudo-random generated states`, `integration-tests/nvca-computed-combinatorial.test.ts:307 :: applies metamorphic checks when dispute-resolution mode toggles from courts to arbitration`, `integration-tests/nvca-spa-template.test.ts:780 :: computes dispute-resolution forum defaults and governing-law alignment in exported artifact` |  |

